<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu | Foodie Heaven</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        // Initialize dark mode before page loads to prevent flash
        (function() {
            const savedMode = localStorage.getItem('darkMode');
            if (savedMode === 'true') {
                document.documentElement.classList.add('dark');
            }
        })();
        
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <style>
        body { 
            font-family: 'Poppins', sans-serif;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        .menu-item { 
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .menu-item:hover { 
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .dark .menu-item:hover {
            box-shadow: 0 10px 25px -5px rgba(255, 255, 255, 0.05);
        }
        
        /* Navbar link styles */
        .nav-link {
            color: #374151;
            transition: color 0.3s;
        }
        
        .dark .nav-link {
            color: #d1d5db;
        }
        
        .nav-link:hover {
            color: #3b82f6;
        }
        
        .dark .nav-link:hover {
            color: #60a5fa;
        }
        
        .nav-link-mobile {
            color: #374151;
            transition: color 0.3s;
        }
        
        .dark .nav-link-mobile {
            color: #d1d5db;
        }
        
        .nav-link-mobile:hover {
            color: #3b82f6;
        }
        
        .dark .nav-link-mobile:hover {
            color: #60a5fa;
        }
        
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #ef4444;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
        }
        
        .dark-mode-toggle {
            color: #374151;
            transition: color 0.3s;
        }
        
        .dark .dark-mode-toggle {
            color: #d1d5db;
        }
        
        .dark-mode-toggle:hover {
            color: #3b82f6;
        }
        
        .dark .dark-mode-toggle:hover {
            color: #60a5fa;
        }
        
        .add-to-cart-btn {
            transition: all 0.2s ease;
        }
        
        .add-to-cart-btn:hover {
            transform: scale(1.05);
        }
        
        /* New animations */
        @keyframes shine {
            to {
                background-position: 200% center;
            }
        }
        
        .text-shine {
            background: linear-gradient(90deg, #ff7700, #ffd700, #ff7700);
            background-size: 200% auto;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 3s linear infinite;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .dark ::-webkit-scrollbar-track {
            background: #374151;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c5c5c5;
            border-radius: 4px;
        }
        
        .dark ::-webkit-scrollbar-thumb {
            background: #6b7280;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 text-gray-800 dark:text-gray-200 min-h-screen">
    <!-- Navbar -->
    <nav class="bg-white dark:bg-gray-800 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-3">
                <!-- Logo -->
                <a href="index.html" class="text-2xl font-bold text-blue-600 dark:text-blue-400">
                    <i class="fas fa-utensils mr-2"></i>Foodie<span class="text-orange-500">Heaven</span>
                </a>

                <!-- Desktop Menu -->
                <div class="hidden md:flex items-center space-x-6">
                    <a href="index.html" class="nav-link"><i class="fas fa-home mr-1"></i> Home</a>
                    <a href="restaurants.html" class="nav-link"><i class="fas fa-store mr-1"></i> Restaurants</a>
                    <a href="cart.html" class="relative nav-link">
                        <i class="fas fa-shopping-cart"></i>
                        <span id="cart-count" class="cart-badge">0</span>
                    </a>
                    <a href="login.html" class="nav-link"><i class="fas fa-sign-in-alt mr-1"></i> Login</a>
                    <button onclick="toggleDarkMode()" class="dark-mode-toggle">
                        <i class="fas fa-moon dark:hidden"></i>
                        <i class="fas fa-sun hidden dark:block"></i>
                    </button>
                </div>

                <!-- Mobile Menu Button -->
                <button id="mobile-menu-button" class="md:hidden text-gray-500 dark:text-gray-400 focus:outline-none">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>

            <!-- Mobile Menu (Dropdown) -->
            <div id="mobile-menu" class="hidden md:hidden pb-3">
                <a href="index.html" class="block py-2 nav-link-mobile"><i class="fas fa-home mr-2"></i>Home</a>
                <a href="restaurants.html" class="block py-2 nav-link-mobile"><i class="fas fa-store mr-2"></i>Restaurants</a>
                <a href="cart.html" class="block py-2 nav-link-mobile relative">
                    <i class="fas fa-shopping-cart mr-2"></i>Cart
                    <span id="cart-count-mobile" class="cart-badge">0</span>
                </a>
                <a href="login.html" class="block py-2 nav-link-mobile"><i class="fas fa-sign-in-alt mr-2"></i>Login</a>
                <button onclick="toggleDarkMode()" class="block py-2 nav-link-mobile w-full text-left">
                    <i class="fas fa-moon dark:hidden mr-2"></i>
                    <i class="fas fa-sun hidden dark:inline mr-2"></i>
                    Toggle Theme
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <div class="flex flex-col sm:flex-row items-center justify-between mb-8 gap-4">
            <h1 id="restaurant-name" class="text-2xl sm:text-3xl font-bold text-center sm:text-left dark:text-white">
                <span class="text-shine">
                    <i class="fas fa-utensils mr-2"></i> Menu
                </span>
            </h1>
            <a href="restaurants.html" class="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white px-6 py-3 rounded-full font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl inline-flex items-center">
                <i class="fas fa-arrow-left mr-2"></i> Back to Restaurants
            </a>
        </div>

        <!-- Menu Items -->
        <div id="menu-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <!-- Menu items will load here -->
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 mt-12">
        <div class="container mx-auto px-4 py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Foodie Heaven</h3>
                    <p class="text-gray-600 dark:text-gray-300 mt-2">Delicious food delivered to your doorstep</p>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Quick Links</h3>
                    <ul class="mt-2 space-y-2">
                        <li><a href="index.html" class="text-gray-600 dark:text-gray-300 hover:text-blue-500 transition-colors">Home</a></li>
                        <li><a href="restaurants.html" class="text-gray-600 dark:text-gray-300 hover:text-blue-500 transition-colors">Restaurants</a></li>
                        <li><a href="cart.html" class="text-gray-600 dark:text-gray-300 hover:text-blue-500 transition-colors">Cart</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-white">Contact</h3>
                    <p class="text-gray-600 dark:text-gray-300 mt-2">Email: info@foodieheaven.com</p>
                    <p class="text-gray-600 dark:text-gray-300">Phone: +92 300 1234567</p>
                </div>
            </div>
            <div class="border-t border-gray-200 dark:border-gray-700 mt-8 pt-8 text-center">
                <p class="text-gray-600 dark:text-gray-300">Â© 2024 Foodie Heaven. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        const API_BASE = "http://127.0.0.1:8000/api";
        
        // JWT Token Functions
        function saveToken(token) {
            localStorage.setItem('access_token', token);
        }

        function getToken() {
            return localStorage.getItem('access_token');
        }

        function removeToken() {
            localStorage.removeItem('access_token');
        }

        // Check if user is logged in
        function checkLogin() {
            return !!getToken();
        }

        // API Call Function
        async function authApiCall(endpoint, options = {}) {
            const token = getToken();
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            };
            
            const mergedOptions = {
                ...defaultOptions,
                ...options,
                headers: {
                    ...defaultOptions.headers,
                    ...options.headers
                }
            };
            
            return fetch(API_BASE + endpoint, mergedOptions);
        }

        // Global cart functions
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        function updateCartCount() {
            const count = cart.length;
            document.getElementById('cart-count').textContent = count;
            document.getElementById('cart-count-mobile').textContent = count;
        }

        function addToCart(item) {
            cart.push(item);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            showNotification(`${item.name} added to cart!`);
        }

        function showNotification(message) {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-4 py-3 rounded-lg shadow-lg z-50 flex items-center animate-bounce';
            notification.innerHTML = `<i class="fas fa-check-circle mr-2"></i> ${message}`;
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.classList.remove('animate-bounce');
                notification.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // Dark Mode Toggle - Simple and Effective
        function toggleDarkMode() {
            const html = document.documentElement;
            const isDark = html.classList.toggle('dark');
            localStorage.setItem('darkMode', isDark);
        }

        // Initialize dark mode based on saved preference
        function initDarkMode() {
            const savedMode = localStorage.getItem('darkMode');
            if (savedMode === 'true') {
                document.documentElement.classList.add('dark');
            }
        }

        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobile-menu');
            const button = document.getElementById('mobile-menu-button');
            if (menu) {
                menu.classList.toggle('hidden');
                
                // Change icon
                const icon = button.querySelector('i');
                if (menu.classList.contains('hidden')) {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                } else {
                    icon.classList.remove('fa-bars');
                    icon.classList.add('fa-times');
                }
            }
        }

        async function loadMenu() {
            const urlParams = new URLSearchParams(window.location.search);
            const restaurantId = urlParams.get('restaurant_id');
            const container = document.getElementById('menu-container');
            
            if (!container) return;
            
            // Loading state
            container.innerHTML = `
                <div class="col-span-3 text-center py-12">
                    <i class="fas fa-spinner fa-spin text-4xl text-blue-500 dark:text-blue-400"></i>
                    <p class="mt-4 text-lg text-gray-600 dark:text-gray-300">Loading menu...</p>
                </div>
            `;

            try {
                // 1. First check if restaurant exists
                const restaurantResponse = await authApiCall(`/restaurants/${restaurantId}/`);
                if (!restaurantResponse.ok) {
                    throw new Error('Restaurant not found');
                }
                const restaurant = await restaurantResponse.json();

                // 2. Update page title
                const restaurantNameElement = document.getElementById('restaurant-name');
                if (restaurantNameElement) {
                    restaurantNameElement.innerHTML = `
                        <span class="text-shine">
                            <i class="fas fa-utensils mr-2"></i> ${restaurant.name} Menu
                        </span>
                    `;
                }

                // 3. Fetch menu items with error handling
                const menuResponse = await authApiCall(`/restaurants/${restaurantId}/menu/`);
                
                if (!menuResponse.ok) {
                    throw new Error('Menu loading failed');
                }
                
                const menuItems = await menuResponse.json();

                // 4. Display menu items with fallback for missing images
                container.innerHTML = menuItems.map(item => `
                    <div class="menu-item bg-white dark:bg-gray-800 rounded-xl shadow-md p-5 border border-gray-100 dark:border-gray-700">
                        <div class="flex flex-col">
                            <img src="${item.image || 'https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'}" 
                                alt="${item.name}"
                                class="w-full h-48 object-cover rounded-lg mb-4"
                                onerror="this.src='https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80'">
                            <div class="flex-1">
                                <div class="flex justify-between items-start mb-2">
                                    <h3 class="font-bold text-lg text-gray-800 dark:text-white">${item.name}</h3>
                                    <span class="text-sm text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded-full">
                                        <i class="fas fa-utensils mr-1"></i>
                                    </span>
                                </div>
                                <p class="text-gray-600 dark:text-gray-300 text-sm mb-4 leading-relaxed">${item.description || 'No description available'}</p>
                                <div class="flex justify-between items-center">
                                    <span class="font-bold text-orange-500 text-lg">Rs. ${Number(item.price).toFixed(2)}</span>
                                    <button onclick="addToCart(${JSON.stringify(item).replace(/"/g, '&quot;')})" 
                                        class="add-to-cart-btn bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-105">
                                        <i class="fas fa-plus mr-1"></i> Add to Cart
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = `
                    <div class="col-span-3 text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 dark:text-red-400 mb-4"></i>
                        <p class="text-xl text-gray-800 dark:text-white">${error.message}</p>
                        <button onclick="loadMenu()" 
                            class="mt-4 bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors font-medium">
                            <i class="fas fa-sync-alt mr-2"></i> Try Again
                        </button>
                    </div>
                `;
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            if (!checkLogin()) {
                window.location.href = "login.html";
                return;
            }
            initDarkMode();
            updateCartCount();
            
            // Setup mobile menu toggle
            document.getElementById('mobile-menu-button').addEventListener('click', toggleMobileMenu);
            
            loadMenu();
        });
    </script>
</body>
</html>